/ Page header
- subtitle = @invoice ? "for invoice #{@invoice.date_to.to_date.to_formatted_s}" : 'all entries'
- titles 'Ledger', subtitle, :ledger_entries

/ Page body
.row
  .span3
    = render :partial => 'navlist'
  .span9
    - if @invoice
      / Controls
      .row
        .span9.table-tools
          = link_to 'View Invoice', @invoice.public_link, :class => 'btn btn-success btn-small pull-right', target: '_blank'

    / Ledger entries
    %table.table.table-striped.table-condensed
      %thead
        %tr
          %th.span1
          %th Entry
          %th Recorded
          %th{style:'text-align:right'} Value
          %th.span1 Settled
        %tbody
          - if @ledger_entries.empty?
            %tr
              %td{colspan: 5}
                %em No ledger entries match the search criteria. Please remove search criteria and try again.
          
          - @ledger_entries.each do |ledger_entry|
            %tr
              %td= split_dropdown_list([ |
                { label: 'Details', icon: :show, link: [ @organization, ledger_entry ], if: can?(:show, ledger_entry) }, |
                { label: 'View ' + item_label(ledger_entry.item), icon: item_icon(ledger_entry.item), link: [@organization, ledger_entry.item], if: can?(:show, ledger_entry.item) } |
                ], {class: 'btn-mini'}) |
              %td
                = ledger_entry.narrative
                - unless ledger_entry.blank?
                  %small= ledger_entry.notes
              %td= l ledger_entry.updated_at, format: :short
              %td{style:'text-align:right'}= currency_for ledger_entry.value
              %td= checkmark_for ledger_entry.settled?

  = paginate @ledger_entries
