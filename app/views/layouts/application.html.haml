!!!
%html
  %head
    %title
      = yield(:title)
      = ' â€” ' if content_for?(:title)
      SignalCloud
    = stylesheet_link_tag "application", :media => "all"
    - if content_for?( :stylesheets )
      %style{:type => 'text/css'}= yield :stylesheets
    = javascript_include_tag "application"
    = csrf_meta_tags
  %body
    .container
      / Navigation header
      .navbar>
        .navbar-inner
          %a.brand{:href => "/"}
            %i.icon-cloud
            SignalCloud
          - unless user_signed_in?
            %ul.nav
              %li{ :class => ( request.path == new_user_session_path ? 'active' : '' ) }
                = link_to new_user_session_path do
                  %i.icon-signin
                  Sign In
              -if devise_mapping.registerable?
                %li{ :class => ( request.path == new_user_registration_path ? 'active' : '' ) }
                  = link_to new_user_registration_path do
                    %i.icon-upload-alt
                    Sign Up

          - else
            - if @organization
              %ul.nav
                %li{ rel: 'tooltip', :title => 'Dashboard', :'data-placement' => 'bottom' }
                  %a{ :href => "/" }
                    %i.icon-dashboard
                - if can? :index, User
                  %li{ rel: 'tooltip', :title => 'Users', :'data-placement' => 'bottom' }
                    %a{ :href => organization_users_path(@organization) }= icon( :users )
                - if can? :index, Conversation
                  %li{ rel: 'tooltip', :title => 'Conversations', :'data-placement' => 'bottom' }
                    %a{ :href => organization_conversations_path(@organization) }= icon( :conversations )
                - if can? :index, Stencil
                  %li{ rel: 'tooltip', :title => 'Stencils', :'data-placement' => 'bottom' }
                    %a{ :href => organization_stencils_path(@organization) }= icon( :stencils )
                - if can? :index, PhoneBook
                  %li{ rel: 'tooltip', :title => 'Phone Books', :'data-placement' => 'bottom' }
                    %a{ :href => organization_phone_books_path(@organization) }= icon( :phone_books )
                - if can? :index, PhoneNumber
                  %li{ rel: 'tooltip', :title => 'Phone Numbers', :'data-placement' => 'bottom' }
                    %a{ :href => organization_phone_numbers_path(@organization) }= icon( :phone_numbers )
                - if can? :index, LedgerEntry
                  %li{ rel: 'tooltip', :title => 'Ledger', :'data-placement' => 'bottom' }
                    %a{ :href => organization_ledger_entries_path(@organization) }= icon( :ledger_entries )
  
              -#
                %li.dropdown
                  %a.dropdown-toggle{"data-toggle" => "dropdown", :href => "#"}
                    = icon( @organization.icon || 'briefcase' )
                    Manage
                    %b.caret
                  %ul.dropdown-menu
                    - if can? :index, User
                      %li
                        %a{ :href => organization_users_path(@organization) }
                          = icon(:users)
                          Users
                    - if can? :index, Conversation
                      %li
                        %a{ :href => organization_conversations_path(@organization) }
                          = icon( :conversations )
                          Conversations
                    - if can? :index, Stencil
                      %li
                        %a{ :href => organization_stencils_path(@organization) }
                          = icon( :stencils )
                          Stencils
                    - if can? :index, PhoneBook
                      %li
                        %a{ :href => organization_phone_books_path(@organization) }
                          = icon( :phone_books )
                          Phone Books
                    - if can? :index, PhoneNumber
                      %li
                        %a{ :href => organization_phone_numbers_path(@organization) }
                          = icon( :phone_numbers )
                          Phone Numbers
                    - if can? :index, LedgerEntry
                      %li
                        %a{ :href => organization_ledger_entries_path(@organization) }
                          = icon( :ledger_entries )
                          Ledger
                -#
                  %li
                    %a{ :href => "#" }
                      %i.icon-bar-chart  
                      Reports
  
            %ul.nav.pull-right
              - if @organization
                %li.dropdown
                  %a.dropdown-toggle{"data-toggle" => "dropdown", :href => "#"}
                    = icon( @organization.icon )
                    = @organization.label
                    %b.caret
                  %ul.dropdown-menu
                    - if can? :shadow, Organization
                      %li
                        = link_to organizations_path do
                          = icon( :exchange )
                          Switch organizations
              %li.dropdown
                %a.dropdown-toggle{"data-toggle" => "dropdown", :href => "#"}
                  %i.icon-user
                  = current_user.first_name
                  %b.caret
                %ul.dropdown-menu
                  - if can? :change_password, current_user
                    %li
                      = link_to edit_user_path( current_user ) do
                        %i.icon-key
                        Change password
                  %li
                    = link_to current_user do
                      %i.icon-cogs
                      Preferences
                  %li
                    = link_to destroy_user_session_path, :method => :delete do
                      %i.icon-off
                      Sign out
  
      / Body
      = render 'layouts/messages'
      = render 'layouts/header'
      = yield
  
      / Footer
      .row
        .span12
          %hr
      .row
        .span6
          %p
            %small
              Copyright &copy; 2012-2013
              =link_to 'SignalCloud, llc.', 'http://www.signalcloudapp.com'
              =link_to 'Contact us.', 'mailto:hello@signalcloudapp.com'
        .span6
          %p{style:'text-align:right'}
            %small (#{Rails.env})
