.row
  .span12
    .page-header
      %h1
        = icon( :phone_directories )
        Directories
        %small= @phone_directory.label

.row
  .span3
    = render 'navlist'
  .span9
    %p.well
      - if @phone_directory.description.nil?
        %em No description configured.
      - else
        = @phone_directory.description

    %h4 phone numbers
    %table.table.table-striped
      %thead
        %tr
          %th Country
          %th Number
          %th
      %tbody
        - if @phone_directory.phone_directory_entries.empty?
          %tr
            %td{colspan: 3}
              %em No phone numbers are used by this directory.
        
        - @phone_directory.phone_directory_entries( order: 'country desc, number' ).each do |entry|
          %tr
            %td
              - if entry.country.blank?
                %em Others
              - else
                = entry.country
            %td= entry.phone_number.number
            %td= dropdown_list( 'Manage', [ |
              { label: 'View phone number', icon: :show, link: entry.phone_number, if: can?(:show, entry.phone_number) }, |
              { label: 'Remove from directory', icon: :delete, link: entry, options: { method: :delete, data: { confirm: 'Are you sure?' } }, if: can?(:destroy, entry) } |
              ]) |

    -# %div= link_to 'Link a phone number', new_phone_directory_phone_number_entry_path( @phone_directory ), :class => 'btn btn-success'
            

    %h4 appliances using this directory
    %table.table.table-striped
      %thead
        %tr
          %th Appliance
          %th
      %tbody
        - if @phone_directory.appliances.empty?
          %tr
            %td{colspan: 2}
              %em No appliances use this directory.

        - @phone_directory.appliances.each do |appliance|
          %tr
            %td= link_to appliance.label, appliance
            %td= dropdown_list( 'Manage', [ |
                { label: 'Tickets', icon: :tickets, link: appliance_tickets_path(appliance), if: can?(:show, Ticket) }, |
                { label: 'Details', icon: :show, link: appliance, if: can?(:show, appliance) }, |
                { label: 'Edit', icon: :edit, link: edit_appliance_path(appliance), if: can?(:edit, appliance) }, |
                { label: 'Delete', icon: :delete, link: appliance, options: { method: :delete, data: { confirm: 'Are you sure?' } }, if: can?(:destroy, appliance) } |
                ], { class: "pull-right"} ) |
